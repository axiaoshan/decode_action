const a0_0x3514b1=a0_0x4175;(function(_0x2b9abb,_0x5de41a){const _0xca2df3=a0_0x4175,_0x523833=_0x2b9abb();while(!![]){try{const _0x15b4fe=-parseInt(_0xca2df3(0x128))/0x1*(parseInt(_0xca2df3(0xef))/0x2)+-parseInt(_0xca2df3(0xd5))/0x3*(parseInt(_0xca2df3(0xed))/0x4)+-parseInt(_0xca2df3(0xe9))/0x5+parseInt(_0xca2df3(0xf9))/0x6*(parseInt(_0xca2df3(0x12a))/0x7)+-parseInt(_0xca2df3(0x158))/0x8+parseInt(_0xca2df3(0x117))/0x9+parseInt(_0xca2df3(0x123))/0xa;if(_0x15b4fe===_0x5de41a)break;else _0x523833['push'](_0x523833['shift']());}catch(_0x978e14){_0x523833['push'](_0x523833['shift']());}}}(a0_0x5dfa,0x69972));const fs=require('fs'),path=require(a0_0x3514b1(0xf6)),crypto=require('crypto'),axios=require('axios'),{machineIdSync}=require(a0_0x3514b1(0x139));function a0_0x5dfa(){const _0x2348d6=['abs','aesEncrypt','597ZylEGs','emitStatusChange','endDate','auth_device_id.txt','existsSync','configFile','digest','模式参数错误，仅支持\x200\x20或\x201','code','failedValidations','sha1','签名错误','floor','post','License/heartBeat/','lastPassword','次数不足','请先完成网络验证','update','已禁用换机功能','2282260beMjbk','hex','400','203','12032kZwWCP','authKey','6baqVVB','201','auth_config.json','403','loadDeviceId','request','deviceId','path','601','heartbeatTimer','42JjwYlV','aesDecrypt','apiUrl','buildUrl','from','final','zQ96wwUcXAZRVltG','lastVerifiedAt','503','logout','max','您还剩余：','secretKey','504','validateConfig','password','setAutoPadding','配置为空','600','\x20次可用次数','sign','toString','stringify','msg','lastAccount','心跳失败','changeDevice','trim','heartBeat','join','6459651hLzjnb','103','deviceIdFile','stateFile','getStatus','heartDuration','配置错误','saveState','concat','has','secretKey\x20长度必须为\x2016\x20位','start','7183350GngyYq','random','getAuthorizationStatus','appId','authorized','92381EKNXpy','502','480081qiONVS','mode','configValidation','有效期到：','length','config','未配置认证线路','http://api.kushao.net/v3/','utf8','startHeartbeat','appId\x20不能为空','data','createHash','invalidate','101','node-machine-id','error','ensureAuthorized','message','exports','base64','writeFileSync','includes','parse','replace','expireAt','createCipheriv','account','auth_state.json','aes-128-ecb','endsWith','200','getTimestamp','6986093f','now','isFinite','toISOString','100','getConfig','loadConfig','timeStamp','remark','签名过期','onInvalid','token','401','1211760pvywGA','readFileSync','surplusCount','secretKey\x20不能为空','verify','未验证','lastVerifySuccess','onStatusChange','isAuthorized','state','验证失败','loadState','stopHeartbeat','409'];a0_0x5dfa=function(){return _0x2348d6;};return a0_0x5dfa();}class AuthService{constructor(_0x45ec39={}){const _0x1c7829=a0_0x3514b1;this['onStatusChange']=_0x45ec39['onStatusChange']||null,this[_0x1c7829(0x155)]=_0x45ec39[_0x1c7829(0x155)]||null,this[_0x1c7829(0xda)]=path[_0x1c7829(0x116)](__dirname,_0x1c7829(0xf1)),this[_0x1c7829(0x11a)]=path[_0x1c7829(0x116)](__dirname,_0x1c7829(0x146)),this[_0x1c7829(0x119)]=path['join'](__dirname,_0x1c7829(0xd8)),this[_0x1c7829(0xde)]=0x0,this[_0x1c7829(0xf8)]=null,this[_0x1c7829(0x12f)]=this['loadConfig'](),this[_0x1c7829(0x12c)]=this[_0x1c7829(0x107)](this['config']),this[_0x1c7829(0xf5)]=this[_0x1c7829(0xf3)](),this[_0x1c7829(0x161)]=this['loadState'](),this[_0x1c7829(0x161)][_0x1c7829(0x127)]&&this['state'][_0x1c7829(0x156)]&&this['startHeartbeat']();}[a0_0x3514b1(0x151)](){const _0x772c6d=a0_0x3514b1,_0x2b4091={'appId':_0x772c6d(0x14b),'secretKey':_0x772c6d(0xff),'apiUrl':_0x772c6d(0x131),'mode':0x0,'changeMode':0x1,'heartDuration':0x258,'authKey':''};if(!fs[_0x772c6d(0xd9)](this[_0x772c6d(0xda)]))return _0x2b4091;try{const _0xc7ffa7=fs[_0x772c6d(0x159)](this[_0x772c6d(0xda)],_0x772c6d(0x132)),_0x4bd102=JSON[_0x772c6d(0x141)](_0xc7ffa7)||{};return{..._0x2b4091,'apiUrl':_0x4bd102['apiUrl']||_0x2b4091[_0x772c6d(0xfb)],'authKey':_0x4bd102['authKey']||''};}catch(_0x2f8627){return _0x2b4091;}}[a0_0x3514b1(0x107)](_0x56d274){const _0x189442=a0_0x3514b1;if(!_0x56d274||typeof _0x56d274!=='object')return{'ok':![],'error':_0x189442(0x10a)};if(!_0x56d274[_0x189442(0x126)]||String(_0x56d274['appId'])[_0x189442(0x114)]()==='')return{'ok':![],'error':_0x189442(0x134)};const _0x1dc3a1=String(_0x56d274[_0x189442(0x105)]||'');if(!_0x1dc3a1)return{'ok':![],'error':_0x189442(0x15b)};if(_0x1dc3a1[_0x189442(0x12e)]!==0x10)return{'ok':![],'error':_0x189442(0x121)};if(!_0x56d274[_0x189442(0xfb)]||String(_0x56d274[_0x189442(0xfb)])[_0x189442(0x114)]()==='')return{'ok':![],'error':'认证线路不能为空'};const _0x3b3a70=Number(_0x56d274[_0x189442(0x12b)]);if(![0x0,0x1][_0x189442(0x140)](_0x3b3a70))return{'ok':![],'error':_0x189442(0xdc)};const _0xf68421=Number(_0x56d274[_0x189442(0x11c)]);if(!Number[_0x189442(0x14d)](_0xf68421)||_0xf68421<0xc8||_0xf68421>0xdac)return{'ok':![],'error':'心跳间隔必须为\x20200–3500\x20秒'};return{'ok':!![]};}['updateConfig'](_0x52aea7={}){const _0x5edbff=a0_0x3514b1,_0x8e6cb7={...this['config'],'apiUrl':_0x52aea7[_0x5edbff(0xfb)]!==undefined?_0x52aea7[_0x5edbff(0xfb)]:this[_0x5edbff(0x12f)]['apiUrl'],'authKey':_0x52aea7[_0x5edbff(0xee)]!==undefined?_0x52aea7[_0x5edbff(0xee)]:this[_0x5edbff(0x12f)]['authKey']},_0x370746=this['validateConfig'](_0x8e6cb7);this[_0x5edbff(0x12c)]=_0x370746;if(!_0x370746['ok'])return _0x370746;this['config']=_0x8e6cb7;try{fs[_0x5edbff(0x13f)](this['configFile'],JSON[_0x5edbff(0x10f)]({'apiUrl':this['config'][_0x5edbff(0xfb)],'authKey':this['config'][_0x5edbff(0xee)]},null,0x2),_0x5edbff(0x132));}catch(_0x30a8b6){return{'ok':![],'error':_0x30a8b6['message']};}return this[_0x5edbff(0x161)][_0x5edbff(0x127)]&&this[_0x5edbff(0x133)](),{'ok':!![]};}[a0_0x3514b1(0x150)](){const _0x5cc537=a0_0x3514b1;return{'apiUrl':this['config'][_0x5cc537(0xfb)],'authKey':this[_0x5cc537(0x12f)][_0x5cc537(0xee)]||''};}[a0_0x3514b1(0xf3)](){const _0x476f0b=a0_0x3514b1;try{if(fs[_0x476f0b(0xd9)](this[_0x476f0b(0x119)])){const _0x7b081f=fs[_0x476f0b(0x159)](this[_0x476f0b(0x119)],'utf8')[_0x476f0b(0x114)]();if(_0x7b081f)return _0x7b081f;}}catch(_0x10529b){}let _0x27f61a='';try{_0x27f61a=machineIdSync({'original':!![]});}catch(_0x1445f1){_0x27f61a=Date[_0x476f0b(0x14c)]()+'_'+Math[_0x476f0b(0x124)]();}const _0x1495be=this[_0x476f0b(0xdf)](_0x27f61a);try{fs[_0x476f0b(0x13f)](this[_0x476f0b(0x119)],_0x1495be,_0x476f0b(0x132));}catch(_0x994a53){}return _0x1495be;}[a0_0x3514b1(0x163)](){const _0x439dc6=a0_0x3514b1;if(!fs[_0x439dc6(0xd9)](this[_0x439dc6(0x11a)]))return{'authorized':![],'code':null,'message':'未验证','token':null,'remark':'','expireAt':null,'surplusCount':null,'lastVerifiedAt':null,'lastVerifySuccess':![]};try{const _0x40eda2=fs['readFileSync'](this[_0x439dc6(0x11a)],'utf8'),_0x56a70c=JSON[_0x439dc6(0x141)](_0x40eda2)||{};return{'authorized':!!_0x56a70c[_0x439dc6(0x127)],'code':_0x56a70c[_0x439dc6(0xdd)]??null,'message':_0x56a70c['message']||_0x439dc6(0x15d),'token':_0x56a70c[_0x439dc6(0x156)]||null,'remark':_0x56a70c[_0x439dc6(0x153)]||'','expireAt':_0x56a70c['expireAt']||null,'surplusCount':_0x56a70c[_0x439dc6(0x15a)]||null,'lastVerifiedAt':_0x56a70c['lastVerifiedAt']||null,'lastAccount':_0x56a70c['lastAccount'],'lastPassword':_0x56a70c[_0x439dc6(0xe4)],'lastVerifySuccess':_0x56a70c[_0x439dc6(0x15e)]!==undefined?_0x56a70c[_0x439dc6(0x15e)]:!!_0x56a70c[_0x439dc6(0x127)]};}catch(_0x1751f3){return{'authorized':![],'code':null,'message':_0x439dc6(0x15d),'token':null,'remark':'','expireAt':null,'surplusCount':null,'lastVerifiedAt':null,'lastVerifySuccess':![]};}}[a0_0x3514b1(0x11e)](){const _0x11a2dd=a0_0x3514b1;try{fs[_0x11a2dd(0x13f)](this['stateFile'],JSON[_0x11a2dd(0x10f)](this[_0x11a2dd(0x161)],null,0x2),'utf8');}catch(_0x21bea1){}}[a0_0x3514b1(0xdf)](_0x9739ec){const _0x4ce964=a0_0x3514b1;return crypto[_0x4ce964(0x136)](_0x4ce964(0xdf))['update'](String(_0x9739ec))[_0x4ce964(0xdb)](_0x4ce964(0xea));}[a0_0x3514b1(0xd4)](_0x4dd124){const _0x1a1e3=a0_0x3514b1;if(!this[_0x1a1e3(0x12c)]['ok'])throw new Error(this[_0x1a1e3(0x12c)][_0x1a1e3(0x13a)]||_0x1a1e3(0x11d));const _0x45483e=Buffer[_0x1a1e3(0xfd)](this[_0x1a1e3(0x12f)][_0x1a1e3(0x105)],_0x1a1e3(0x132)),_0x3dc987=crypto[_0x1a1e3(0x144)](_0x1a1e3(0x147),_0x45483e,null);_0x3dc987[_0x1a1e3(0x109)](!![]);const _0x594b28=Buffer[_0x1a1e3(0x11f)]([_0x3dc987['update'](String(_0x4dd124),_0x1a1e3(0x132)),_0x3dc987[_0x1a1e3(0xfe)]()]);return _0x594b28[_0x1a1e3(0x10e)](_0x1a1e3(0x13e));}[a0_0x3514b1(0xfa)](_0x5707e5){const _0x496dbb=a0_0x3514b1;if(!this[_0x496dbb(0x12c)]['ok'])throw new Error(this[_0x496dbb(0x12c)][_0x496dbb(0x13a)]||'配置错误');const _0x668ed=Buffer['from'](this['config'][_0x496dbb(0x105)],'utf8'),_0x2cadd7=crypto['createDecipheriv']('aes-128-ecb',_0x668ed,null);_0x2cadd7[_0x496dbb(0x109)](!![]);const _0x371191=Buffer[_0x496dbb(0x11f)]([_0x2cadd7[_0x496dbb(0xe7)](String(_0x5707e5),'base64'),_0x2cadd7[_0x496dbb(0xfe)]()]);return _0x371191['toString'](_0x496dbb(0x132));}[a0_0x3514b1(0x14a)](){const _0x1a44f7=a0_0x3514b1;return String(Math[_0x1a44f7(0xe1)](Date[_0x1a44f7(0x14c)]()/0x3e8));}[a0_0x3514b1(0xfc)](_0x261ba2){const _0x534f91=a0_0x3514b1,_0x337ad5=this['config'][_0x534f91(0xfb)][_0x534f91(0x148)]('/')?this[_0x534f91(0x12f)][_0x534f91(0xfb)]:this[_0x534f91(0x12f)][_0x534f91(0xfb)]+'/';return''+_0x337ad5+_0x261ba2;}async[a0_0x3514b1(0xf4)](_0x28b5b4,_0x42ee4d){const _0x1c90b4=a0_0x3514b1;if(!this[_0x1c90b4(0x12c)]['ok'])return{'code':'403','msg':this[_0x1c90b4(0x12c)][_0x1c90b4(0x13a)]||_0x1c90b4(0x11d)};if(!this['config'][_0x1c90b4(0xfb)])return{'code':this['aesEncrypt'](_0x1c90b4(0xf2)),'msg':this['aesEncrypt'](_0x1c90b4(0x130))};const _0x1ddf33=_0x42ee4d['join']('|'),_0x3c98f7=this['aesEncrypt'](_0x1ddf33),_0x267376=[_0x28b5b4,..._0x42ee4d,this[_0x1c90b4(0x12f)]['secretKey']],_0x40704f=this[_0x1c90b4(0xdf)](_0x267376['join'](''));try{const _0x407909=await axios[_0x1c90b4(0xe2)](this[_0x1c90b4(0xfc)](_0x28b5b4),{'data':_0x3c98f7,'sign':_0x40704f},{'headers':{'User-Agent':'Node_'+this[_0x1c90b4(0x12f)][_0x1c90b4(0x126)]},'timeout':0x2710});return _0x407909[_0x1c90b4(0x135)];}catch(_0x24f1fe){return{'code':this[_0x1c90b4(0xd4)](_0x1c90b4(0xf2)),'msg':this[_0x1c90b4(0xd4)](_0x24f1fe[_0x1c90b4(0x13c)])};}}async[a0_0x3514b1(0x15c)](_0x5c4b5d,_0x55bb67=''){const _0x2d057f=a0_0x3514b1;if(!this[_0x2d057f(0x12c)]['ok'])return{'code':'403','msg':this[_0x2d057f(0x12c)][_0x2d057f(0x13a)]||_0x2d057f(0x11d)};const _0xdcc9ac=String(_0x5c4b5d||'')[_0x2d057f(0x114)](),_0xb0058d=String(_0x55bb67||'')[_0x2d057f(0x114)]();if(!_0xdcc9ac)return{'code':_0x2d057f(0xeb),'msg':'卡密/账号不能为空'};const _0x11ec6e=this[_0x2d057f(0x14a)](),_0x984830='License/verify/'+this[_0x2d057f(0x12f)]['appId'],_0x2fbe68=[this[_0x2d057f(0x12f)]['mode'],_0xdcc9ac,_0xb0058d,this['deviceId'],Number(_0x11ec6e)],_0x5286e3=await this[_0x2d057f(0xf4)](_0x984830,_0x2fbe68);_0x5286e3[_0x2d057f(0xdd)]=this['aesDecrypt'](_0x5286e3['code']);if(_0x5286e3[_0x2d057f(0xdd)]===_0x2d057f(0x149)){const _0x28c4f0=this[_0x2d057f(0xfa)](_0x5286e3[_0x2d057f(0x156)]),_0x2f144c=this[_0x2d057f(0xfa)](_0x5286e3[_0x2d057f(0x153)]),_0x381c3c=this[_0x2d057f(0xfa)](_0x5286e3['timeStamp']);let _0x226e43=[],_0x15e5f=null,_0x175712=null;if(this[_0x2d057f(0x12f)][_0x2d057f(0x12b)]===0x0){const _0x61c509=this['aesDecrypt'](_0x5286e3[_0x2d057f(0xd7)]);_0x15e5f=_0x61c509,_0x226e43=[_0x5286e3[_0x2d057f(0xdd)],_0x61c509,_0x28c4f0,_0x2f144c,_0x381c3c,this[_0x2d057f(0x12f)][_0x2d057f(0x105)]],_0x5286e3[_0x2d057f(0x110)]=_0x2d057f(0x12d)+_0x61c509;}else{const _0x3d1d47=this['aesDecrypt'](_0x5286e3[_0x2d057f(0x15a)]);_0x175712=_0x3d1d47,_0x226e43=[_0x5286e3[_0x2d057f(0xdd)],_0x3d1d47,_0x28c4f0,_0x2f144c,_0x381c3c,this[_0x2d057f(0x12f)][_0x2d057f(0x105)]],_0x5286e3[_0x2d057f(0x110)]=_0x2d057f(0x104)+_0x3d1d47+_0x2d057f(0x10c);}if(_0x5286e3[_0x2d057f(0x10d)]!==this[_0x2d057f(0xdf)](_0x226e43[_0x2d057f(0x116)]('')))return{'code':_0x2d057f(0x101),'msg':'签名错误'};if(Math[_0x2d057f(0xd3)](Number(_0x381c3c)-Number(_0x11ec6e))>0x64)return{'code':'502','msg':_0x2d057f(0x154)};return this['state']={'authorized':!![],'code':_0x5286e3['code'],'message':_0x5286e3['msg'],'token':_0x28c4f0,'remark':_0x2f144c,'expireAt':_0x15e5f,'surplusCount':_0x175712,'lastVerifiedAt':new Date()[_0x2d057f(0x14e)](),'lastAccount':_0xdcc9ac,'lastPassword':_0xb0058d,'lastVerifySuccess':!![]},this[_0x2d057f(0x11e)](),this[_0x2d057f(0xde)]=0x0,this[_0x2d057f(0x133)](),this[_0x2d057f(0xd6)](),{...this[_0x2d057f(0x161)]};}let _0xc36749='';try{_0xc36749=this[_0x2d057f(0xfa)](_0x5286e3[_0x2d057f(0x110)]);}catch(_0x5db3ee){_0xc36749=_0x5286e3[_0x2d057f(0x110)]||_0x2d057f(0x162);}return this['invalidate'](_0xc36749||_0x2d057f(0x162),_0x5286e3['code']),{'code':_0x5286e3[_0x2d057f(0xdd)],'msg':_0xc36749||'验证失败'};}async[a0_0x3514b1(0x113)](_0x1cb954=''){const _0x5b0f4b=a0_0x3514b1;return{'code':_0x5b0f4b(0x165),'msg':_0x5b0f4b(0xe8)};}async[a0_0x3514b1(0x115)](_0x277101={}){const _0x3ac7d4=a0_0x3514b1;if(!this[_0x3ac7d4(0x161)][_0x3ac7d4(0x156)])return{'ok':![],'code':_0x3ac7d4(0x157),'message':'未验证'};if(!this[_0x3ac7d4(0x12c)]['ok'])return{'ok':![],'code':_0x3ac7d4(0xf2),'message':this[_0x3ac7d4(0x12c)][_0x3ac7d4(0x13a)]||'配置错误'};const _0x26917a=this[_0x3ac7d4(0x14a)](),_0x5ec4fa=_0x3ac7d4(0xe3)+this[_0x3ac7d4(0x12f)]['appId'],_0xbd0689=[this[_0x3ac7d4(0x161)][_0x3ac7d4(0x156)],this[_0x3ac7d4(0xf5)],Number(_0x26917a)],_0x1185ee=await this[_0x3ac7d4(0xf4)](_0x5ec4fa,_0xbd0689);_0x1185ee[_0x3ac7d4(0xdd)]=this[_0x3ac7d4(0xfa)](_0x1185ee[_0x3ac7d4(0xdd)]);const _0xbec22a=new Set([_0x3ac7d4(0x14f),'101',_0x3ac7d4(0x118),_0x3ac7d4(0xf0),_0x3ac7d4(0xec),_0x3ac7d4(0x129),_0x3ac7d4(0x101),_0x3ac7d4(0x106),_0x3ac7d4(0x10b),_0x3ac7d4(0xf7)]);if(_0x1185ee['code']===_0x3ac7d4(0x149)){this[_0x3ac7d4(0xde)]=0x0;const _0x3ed807=this[_0x3ac7d4(0xfa)](_0x1185ee[_0x3ac7d4(0x152)]);if(this[_0x3ac7d4(0x12f)][_0x3ac7d4(0x12b)]===0x0){const _0x1fe999=this['aesDecrypt'](_0x1185ee[_0x3ac7d4(0xd7)]),_0x3ced2d=[_0x1185ee['code'],_0x1fe999,_0x3ed807,this[_0x3ac7d4(0x12f)][_0x3ac7d4(0x105)]];if(_0x1185ee[_0x3ac7d4(0x10d)]!==this[_0x3ac7d4(0xdf)](_0x3ced2d[_0x3ac7d4(0x116)]('')))return this[_0x3ac7d4(0x137)](_0x3ac7d4(0xe0),'503');this[_0x3ac7d4(0x161)]['expireAt']=_0x1fe999;}else{const _0x2504e9=this[_0x3ac7d4(0xfa)](_0x1185ee[_0x3ac7d4(0x15a)]),_0x390e50=[_0x1185ee[_0x3ac7d4(0xdd)],_0x2504e9,_0x3ed807,this[_0x3ac7d4(0x12f)][_0x3ac7d4(0x105)]];if(_0x1185ee[_0x3ac7d4(0x10d)]!==this['sha1'](_0x390e50['join']('')))return this['invalidate'](_0x3ac7d4(0xe0),'503');this[_0x3ac7d4(0x161)][_0x3ac7d4(0x15a)]=_0x2504e9;}if(Math[_0x3ac7d4(0xd3)](Number(_0x3ed807)-Number(_0x26917a))>0x64)return this[_0x3ac7d4(0x137)]('签名过期','502');return this[_0x3ac7d4(0x11e)](),this[_0x3ac7d4(0xd6)](),{'ok':!![],'status':this[_0x3ac7d4(0x11b)]()};}if(_0xbec22a[_0x3ac7d4(0x120)](String(_0x1185ee[_0x3ac7d4(0xdd)]))){let _0x75c394='';try{_0x75c394=this[_0x3ac7d4(0xfa)](_0x1185ee[_0x3ac7d4(0x110)]);}catch(_0x2e4f31){_0x75c394='';}return this[_0x3ac7d4(0x137)](_0x75c394||_0x3ac7d4(0x112),_0x1185ee[_0x3ac7d4(0xdd)]),{'ok':![],'code':_0x1185ee['code'],'message':_0x75c394||_0x3ac7d4(0x112),'invalidated':!![]};}this[_0x3ac7d4(0xde)]+=0x1;if(this[_0x3ac7d4(0xde)]>=0x3){let _0x4e3703='';try{_0x4e3703=this['aesDecrypt'](_0x1185ee[_0x3ac7d4(0x110)]);}catch(_0xaebfdb){_0x4e3703='';}return this[_0x3ac7d4(0x137)](_0x4e3703||_0x3ac7d4(0x112),_0x1185ee['code']),{'ok':![],'code':_0x1185ee['code'],'message':_0x4e3703||_0x3ac7d4(0x112),'invalidated':!![]};}let _0x16133d='';try{_0x16133d=this[_0x3ac7d4(0xfa)](_0x1185ee[_0x3ac7d4(0x110)]);}catch(_0x3db449){_0x16133d='';}return{'ok':![],'code':_0x1185ee['code'],'message':_0x16133d||_0x3ac7d4(0x112),'retryable':!![]};}['startHeartbeat'](){const _0x593f41=a0_0x3514b1;this[_0x593f41(0x164)]();const _0x54c07a=Math[_0x593f41(0x103)](0xc8,Number(this[_0x593f41(0x12f)][_0x593f41(0x11c)]||0x258))*0x3e8;this[_0x593f41(0xf8)]=setInterval(()=>{const _0x25734f=_0x593f41;this[_0x25734f(0x115)]();},_0x54c07a);}['stopHeartbeat'](){const _0x2896a9=a0_0x3514b1;this[_0x2896a9(0xf8)]&&(clearInterval(this[_0x2896a9(0xf8)]),this[_0x2896a9(0xf8)]=null);}[a0_0x3514b1(0x137)](_0x5901e0,_0x4b119e){const _0x73c902=a0_0x3514b1;this[_0x73c902(0x164)](),this[_0x73c902(0x161)][_0x73c902(0x127)]=![],this['state'][_0x73c902(0xdd)]=_0x4b119e||_0x73c902(0x157),this['state'][_0x73c902(0x13c)]=_0x5901e0||'验证失败',this[_0x73c902(0x161)][_0x73c902(0x156)]=null,this[_0x73c902(0x161)][_0x73c902(0x100)]=new Date()[_0x73c902(0x14e)](),this['state'][_0x73c902(0x15e)]=![],this[_0x73c902(0x11e)](),this[_0x73c902(0xd6)](),this[_0x73c902(0x155)]&&this[_0x73c902(0x155)](this[_0x73c902(0x161)]);}[a0_0x3514b1(0x102)](){const _0x13f1a8=a0_0x3514b1;this[_0x13f1a8(0x164)](),this[_0x13f1a8(0x161)]={'authorized':![],'code':null,'message':'已退出验证','token':null,'remark':'','expireAt':null,'surplusCount':null,'lastVerifiedAt':new Date()[_0x13f1a8(0x14e)](),'lastVerifySuccess':![]},this['saveState'](),this['emitStatusChange']();}[a0_0x3514b1(0xd6)](){const _0x1897ab=a0_0x3514b1;this['onStatusChange']&&this[_0x1897ab(0x15f)](this[_0x1897ab(0x11b)]());}[a0_0x3514b1(0x11b)](){const _0x303773=a0_0x3514b1,_0x541bac={'authorized':!!this[_0x303773(0x161)]['authorized'],'code':this['state']['code'],'message':this[_0x303773(0x161)][_0x303773(0x13c)],'remark':this['state'][_0x303773(0x153)]||'','expireAt':this[_0x303773(0x161)][_0x303773(0x143)]||null,'surplusCount':this['state']['surplusCount']||null,'lastVerifiedAt':this[_0x303773(0x161)][_0x303773(0x100)]||null},_0x5e491d=this[_0x303773(0x125)]();return _0x541bac[_0x303773(0x127)]=_0x5e491d[_0x303773(0x127)],_0x5e491d['message']&&(_0x541bac[_0x303773(0x13c)]=_0x5e491d[_0x303773(0x13c)],_0x541bac[_0x303773(0xdd)]=_0x5e491d[_0x303773(0xdd)]||_0x541bac['code']),_0x541bac;}[a0_0x3514b1(0x160)](){const _0x309148=a0_0x3514b1;return this['getAuthorizationStatus']()[_0x309148(0x127)];}async[a0_0x3514b1(0x13b)](_0x1c7a88={}){const _0x247e99=a0_0x3514b1,_0x37fcec=_0x1c7a88[_0x247e99(0x12b)]||_0x247e99(0x122),_0x433b8b=_0x1c7a88[_0x247e99(0x145)],_0x8adb29=_0x1c7a88[_0x247e99(0x108)]||'';if(!this[_0x247e99(0x12c)]['ok'])return{'ok':![],'code':'403','message':this[_0x247e99(0x12c)][_0x247e99(0x13a)]||_0x247e99(0x11d)};if(!this['state'][_0x247e99(0x127)]){if(_0x433b8b){const _0x282405=await this[_0x247e99(0x15c)](_0x433b8b,_0x8adb29);if(_0x282405&&_0x282405[_0x247e99(0x127)])return{'ok':!![],'status':this[_0x247e99(0x11b)]()};return{'ok':![],'code':_0x282405['code']||_0x247e99(0x157),'message':_0x282405[_0x247e99(0x110)]||_0x247e99(0x15d)};}if(this[_0x247e99(0x161)][_0x247e99(0x111)]){const _0x2855cb=await this['verify'](this[_0x247e99(0x161)]['lastAccount'],this[_0x247e99(0x161)][_0x247e99(0xe4)]||'');if(_0x2855cb&&_0x2855cb[_0x247e99(0x127)])return{'ok':!![],'status':this[_0x247e99(0x11b)]()};return{'ok':![],'code':_0x2855cb['code']||_0x247e99(0x157),'message':_0x2855cb[_0x247e99(0x110)]||_0x247e99(0x15d)};}return{'ok':![],'code':_0x247e99(0x157),'message':'未验证'};}if(!this[_0x247e99(0x161)]['token'])return{'ok':![],'code':_0x247e99(0x157),'message':_0x247e99(0x15d)};if(_0x433b8b&&_0x433b8b!==this['state']['lastAccount']){const _0x3aae94=await this[_0x247e99(0x15c)](_0x433b8b,_0x8adb29);if(_0x3aae94&&_0x3aae94[_0x247e99(0x127)])return{'ok':!![],'status':this[_0x247e99(0x11b)]()};return{'ok':![],'code':_0x3aae94['code']||_0x247e99(0x157),'message':_0x3aae94[_0x247e99(0x110)]||_0x247e99(0x15d)};}if(!this[_0x247e99(0x161)][_0x247e99(0x15e)])return{'ok':![],'code':_0x247e99(0x157),'message':_0x247e99(0xe6)};const _0x480597=await this[_0x247e99(0x115)]({'mode':_0x37fcec});if(_0x480597&&_0x480597['ok'])return{'ok':!![],'status':this['getStatus']()};return{'ok':![],'code':_0x480597?.[_0x247e99(0xdd)]||_0x247e99(0x157),'message':_0x480597?.['message']||_0x247e99(0x162)};}[a0_0x3514b1(0x125)](){const _0x36859a=a0_0x3514b1;if(!this[_0x36859a(0x161)]['authorized'])return{'authorized':![]};if(!this[_0x36859a(0x161)][_0x36859a(0x156)])return{'authorized':![],'message':_0x36859a(0x15d),'code':_0x36859a(0x157)};if(!this[_0x36859a(0x12c)]['ok'])return{'authorized':![],'message':this[_0x36859a(0x12c)][_0x36859a(0x13a)]||'配置错误','code':_0x36859a(0xf2)};if(Number(this['config'][_0x36859a(0x12b)])===0x0){if(this[_0x36859a(0x161)][_0x36859a(0x143)]){const _0x199730=Date[_0x36859a(0x141)](String(this[_0x36859a(0x161)]['expireAt'])[_0x36859a(0x142)](/-/g,'/'));if(Number['isFinite'](_0x199730)&&Date[_0x36859a(0x14c)]()>_0x199730)return{'authorized':![],'message':'授权已过期','code':_0x36859a(0x138)};}}else{const _0x246619=Number(this[_0x36859a(0x161)]['surplusCount']||0x0);if(_0x246619<=0x0)return{'authorized':![],'message':_0x36859a(0xe5),'code':_0x36859a(0xf0)};}return{'authorized':!![]};}}function a0_0x4175(_0x548611,_0x51c1b3){_0x548611=_0x548611-0xd3;const _0x5dfaf7=a0_0x5dfa();let _0x417568=_0x5dfaf7[_0x548611];return _0x417568;}module[a0_0x3514b1(0x13d)]=AuthService;
